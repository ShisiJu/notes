# 数据库索引 - 索引类型

## 索引类型

### 为什么索引有很多种

答: 在不同的场景下, 应该选择不同的索引; 

pg 数据库提供了非常多的索引

- B-tree
- Hash
- GiST
- SP-GiST
- GIN
- BRIN
- 等等

每一种索引都有不同的算法, 它们适用于不同的类型的查询;
默认情况下, 会创建B-tree索引, 因为它适用于多数情况;


推荐阅读

**这篇文章讲得特别好, 推荐大家去看看**

[PostgreSQL 9种索引的原理和应用场景](https://developer.aliyun.com/article/111793)

我这里就只写 B-tree 和 hash 这两个最常用的;

### B-tree

#### B-tree 应用场景是什么


答: B-trees 适用于可以处理按某种顺序排序的数据上的相等和范围查询;

例如: 

- id
- 英文的姓名 alex James 之类
- 身份证号码
- 行政编码

#### 什么时候pg会使用B-tree索引

当一个被索引的列使用下面的操作符, PostgreSQL 的 query planner 将考虑使用 B-tree 索引.

- `<`
- `<=`
- `=`
- `>=`
- `>`
- `BETWEEN`
- `IN`
- `IS NULL` or `IS NOT NUL`

当 `LIKE 'foo%'` or `col ~ '^foo'` 时, 数据库的优化器(optimizer)也将使用 B-tree 索引;
但是, `LIKE '%bar'` 就无法使用了;


#### 怎么创建B-tree索引

答: 

```sql
CREATE INDEX product_name_index ON product (name);
```

我们在 product 的name字段上加入B-tree索引;

我们进行几个查询, 来验证索引的功效;

```sql
explain analyse
select *
from product 
where name = 'CPGXYQZERUQI'
```

没有索引之前
Execution Time: 432.797 ms



```sql
explain analyse
select *
from product 
where name like 'CA%'
```

Execution Time: 452.220 ms





### hash 

#### hash 应用场景是什么

hash索引存储的是被索引字段VALUE的哈希值，`只支持等值查询`。

例如很长的字符串，并且用户只需要等值搜索，建议使用hash index。
hash索引特别适用于字段VALUE非常长（不适合b-tree索引，因为b-tree一个PAGE至少要存储3个ENTRY，所以不支持特别长的VALUE）的场景，


```sql
CREATE INDEX hash_index_of_name ON product USING hash (name);
```

DROP INDEX hash_index_of_name;  

Query returned successfully in 20 secs 879 msec.

加上hash 索引之后只要  60ms
